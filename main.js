(()=>{"use strict";const e=e=>({length:e,receivedHit:0,isSunked:!1,hit(){return this.receivedHit+=1},isSunk(){return this.length===this.receivedHit?this.isSunked=!0:this.isSunked=!1}});function t(e=[],t=10){for(let n=0;n<t;n++){e[n]=[];for(let i=0;i<t;i++)e[n][i]={status:"empty",hipPart:null}}return e}const n=()=>({dimensioneGriglia:10,griglia:t(),pezziDiNavi:0,posizionamentoGrigliaValido:(e,t,n,i)=>"orizzontale"===i?!(n+e.length-1>9):!(t+e.length-1>9),sovrapposizioneNaviValido(e,t,n,i){if("orizzontale"===i){for(let i=n;i<n+e.length;i++)if("empty"!=this.griglia[t][i].status)return!1;return!0}for(let i=t;i<t+e.length;i++)if("empty"!=this.griglia[i][n].status)return!1;return!0},placeShip(e,t,n,i){if(this.posizionamentoGrigliaValido(e,t,n,i)&&this.sovrapposizioneNaviValido(e,t,n,i)){for(let a=0;a<e.length;a++)"orizzontale"===i?(this.griglia[t][n+a].status="ship",this.griglia[t][n+a].shipPart=e,this.pezziDiNavi++):(this.griglia[t+a][n].status="ship",this.griglia[t+a][n].shipPart=e,this.pezziDiNavi++);return!0}return!1},areAllShipsSunk(){return 0===this.pezziDiNavi},receiveAttack(e,t){const n=this.griglia[e][t];"ship"===n.status?(n.status="hit",n.shipPart.hit(),this.pezziDiNavi--,n.shipPart.isSunk()&&this.areAllShipsSunk()&&console.log("Hai distrutto tutte le navi!")):"empty"===n.status&&(n.status="miss")}}),i=t=>({id:t,tabella:n(),naviDisponibili:[e(1),e(2),e(3),e(3),e(4),e(5)],autoPosizionamentoNavi(){if(0!==this.naviDisponibili.length){let e=this.naviDisponibili.pop(),t=!0;for(;t;){let n=Math.floor(10*Math.random()),i=Math.floor(10*Math.random()),a=["orizzontale","verticale"],l=a[Math.floor(Math.random()*a.length)];this.tabella.placeShip(e,n,i,l)&&(t=!1)}this.autoPosizionamentoNavi(this.naviDisponibili)}}});document.body.innerHTML="<style>\n    \n\n    body {\n        margin: 0px;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        max-height: 100%;\n        justify-content: space-between;\n        font-size: 2rem;\n    }\n    \n    .footer {\n        font-size: 2rem;\n        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n        display: flex;\n        gap: 5px;\n        background-color: #1461a1;\n        justify-content: center;\n        z-index: 3;\n    }\n    \n    a{\n        text-decoration: none;\n    }\n    \n    a img {\n        height: 2.1rem;\n        width: 2rem;\n        filter:brightness(0) invert(1);\n    }\n    \n    .nome-github {\n        color: rgb(255, 255, 255);\n    }\n    \n    .titolo {\n        background-color: yellow;\n    }\n\n    .mainContainer {\n        display : flex;\n        flex: 1;\n        flex-wrap: wrap;\n    }\n\n    .parteSinistra {\n        background-color: blue;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 1rem;\n        flex: 1;\n        flex-wrap: wrap;\n        gap: 2rem;\n    }\n\n    .parteDestra {\n        background-color: pink;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 1rem;\n        flex: 1;\n    }\n\n    .tabella {\n        height : clamp(275px,25vw,30rem);\n        width : clamp(275px,25vw,30rem);\n        background-color : white;\n        display: flex;\n        flex-direction: column;\n    }\n\n    .col {\n        border-style: groove;\n        flex: 1;\n    }\n\n    .row {\n        display: flex;\n        flex: 1;\n    }\n\n    .ship {\n        background-image: url(../src/media/battleShip.png);\n        background-size: 100% 100%;\n    }\n\n    .hit {\n        background-image: url(../src/media/hit.png);\n        background-size: 100% 100%;\n    }\n\n    .miss {\n        background-image: url(../src/media/miss.png);\n        background-size: 100% 100%;\n    }\n    .valid {\n        background-color : green;\n    }\n    .invalid {\n        background-color : red;\n    }\n    .info {\n        display: flex;\n        flex-direction: column;\n        gap: 1rem;\n    }\n    .modale {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform : translate(-50%, -50%);\n        height: 200px;\n        width: 200px;\n        padding: 1rem;\n        background: red;\n        z-index: 1001;\n        display: flex;\n        flex-direction: column;\n        text-align: center;\n        justify-content: space-around;\n        align-items: center;\n    }\n\n    .modal-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        z-index: 1000;\n    }\n\n    </style>\n\n    <div class='titolo'>Battle Ship</div>\n    <div id=\"modalOverlay\"></div>\n    <div class=\"mainContainer\">\n        <div class='parteSinistra'>\n            <div class='tabella' id='human'></div>\n            <div class='info'>\n                <span id='dimensioniNave'></span>\n                <button id='rotate'>Ruota la nave</button>\n            </div>        \n        </div>\n        <div class='parteDestra'>\n            <div class='tabella' id='bot'></div>    \n        </div>\n    </div>\n\n    <div class=\"footer\">\n\n        <a href=\"https://github.com/ReXerses\" target=\"_blank\">\n            <img src=\"../src/media/github.svg\" alt=\"Personal Github link\">\n        </a>\n        <a class='nome-github' href=\"https://github.com/ReXerses\" target=\"_blank\">ReXerses</a>\n\n    </div>\n    ";const a=document.getElementById("human"),l=document.getElementById("bot"),o="valid",s="invalid",r=10,d=document.querySelector(".info"),c=document.getElementById("rotate");let u=!0,p="orizzontale",m=i(1),h=i(2),g=document.getElementById("dimensioniNave");b(),h.autoPosizionamentoNavi(),z(h),z(m),l.style.pointerEvents="none";let v=document.querySelectorAll(".casellaGiocatore"),f=document.querySelectorAll(".casellaBot");function b(){m.naviDisponibili[0]&&(g.textContent=`Collocare la nave di dimensioni: ${m.naviDisponibili[m.naviDisponibili.length-1].length}`)}function y(e,t,n,i){"hit"===i.tabella.griglia[t][n].status?(e.classList.remove("ship"),e.classList.add("hit")):"miss"===i.tabella.griglia[t][n].status&&e.classList.add("miss")}function z(e){if(1===e.id)for(let t=0;t<e.tabella.dimensioneGriglia;t++){const n=document.createElement("div");n.className="row",n.dataset.row=t,a.appendChild(n);for(let i=0;i<m.tabella.dimensioneGriglia;i++){const a=document.createElement("div");a.className="col",a.dataset.row=t,a.dataset.col=i,a.classList.add("casellaGiocatore"),"ship"===e.tabella.griglia[t][i].status?a.classList.add("ship"):a.classList.add("empty"),n.appendChild(a)}}else for(let t=0;t<e.tabella.dimensioneGriglia;t++){const n=document.createElement("div");n.className="row",n.dataset.row=t,l.appendChild(n);for(let i=0;i<e.tabella.dimensioneGriglia;i++){const e=document.createElement("div");e.className="col",e.dataset.row=t,e.dataset.col=i,e.classList.add("casellaBot"),n.appendChild(e)}}}function k(e){e.forEach((e=>{e.addEventListener("click",(t=>x(0,e)))}))}function x(e,t){if(0!=m.naviDisponibili.length){let e=parseInt(t.getAttribute("data-row")),i=parseInt(t.getAttribute("data-col")),a=m.naviDisponibili[m.naviDisponibili.length-1];if(m.tabella.posizionamentoGrigliaValido(a,e,i,p)&&m.tabella.sovrapposizioneNaviValido(a,e,i,p)){let t=m.naviDisponibili.pop();m.tabella.placeShip(t,e,i,p),n=m,document.querySelectorAll(".casellaGiocatore").forEach((e=>{let t=e.getAttribute("data-row"),i=e.getAttribute("data-col");"ship"===n.tabella.griglia[t][i].status&&e.classList.add("ship")})),b()}}var n;0===m.naviDisponibili.length&&(v.forEach((e=>{e.removeEventListener("click",x)})),a.innerHTML="",z(m),d.style.display="none",l.addEventListener("click",w),a.addEventListener("click",w))}function S(e){e.forEach((e=>{e.addEventListener("mouseover",(()=>{document.querySelectorAll(".casellaGiocatore").forEach((e=>{e.classList.remove(o,s)}));let t=m.naviDisponibili[m.naviDisponibili.length-1],n=parseInt(e.getAttribute("data-row")),i=parseInt(e.getAttribute("data-col")),a=!0;for(let e=0;e<t.length;e++){let t="orizzontale"===p?i+e:i,l="verticale"===p?n+e:n,o=document.querySelector(`[data-row="${l}"][data-col="${t}"]`);(!o||o.classList.contains("ship")||"verticale"===p&&l>=r||"orizzontale"===p&&t>=r)&&(a=!1)}let l=a?o:s;for(let e=0;e<t.length;e++){let t="orizzontale"===p?i+e:i,a="verticale"===p?n+e:n,o=document.querySelector(`[data-row="${a}"][data-col="${t}"]`);o&&o.classList.add(l)}}))}))}function E(e){e.forEach((e=>{e.addEventListener("click",(()=>{let t=parseInt(e.getAttribute("data-row")),n=parseInt(e.getAttribute("data-col"));"miss"!=h.tabella.griglia[t][n].status&&"hit"!=h.tabella.griglia[t][n].status&&(h.tabella.receiveAttack(t,n),y(e,t,n,h),h.tabella.areAllShipsSunk()?L("HUMAN"):(u=!1,w()))}))}))}function w(){if(u)l.style.pointerEvents="auto";else{l.style.pointerEvents="none";let e=!0;for(;e;){let t=Math.floor(10*Math.random()),n=Math.floor(10*Math.random());if("ship"===m.tabella.griglia[t][n].status||"empty"===m.tabella.griglia[t][n].status){let i=document.querySelector(`[data-row="${t}"][data-col="${n}"]`);m.tabella.receiveAttack(t,n),y(i,t,n,m),e=!1}}m.tabella.areAllShipsSunk()?(L("BOT"),u=!0):(u=!0,w())}}function L(e){const t=document.getElementById("modalOverlay"),n=document.querySelector(".mainContainer"),o=document.createElement("div");o.classList.add("modale");const s=document.createElement("span");s.textContent=`${e} WINS!`,o.appendChild(s);const r=document.createElement("button");r.textContent="Restart",o.appendChild(r),n.appendChild(o),t.classList.add("modal-overlay"),r.addEventListener("click",(()=>{a.style.pointerEvents="auto",t.classList.remove("modal-overlay"),o.style.display="none",m=i(1),h=i(2),h.autoPosizionamentoNavi(),l.innerHTML="",a.innerHTML="",z(h),l.style.pointerEvents="none",d.style.display="flex",z(m);let e=document.querySelectorAll(".casellaGiocatore"),n=document.querySelectorAll(".casellaBot");k(e),S(e),E(n)}))}k(v),S(v),E(f),c.addEventListener("click",(()=>{p="orizzontale"===p?"verticale":"orizzontale"}))})();